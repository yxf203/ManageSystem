import { dayjs } from "element-plus";
import { defineStore } from "pinia";
import { useTableDataStore } from "./tableData";
export const useBillListStore = defineStore('billList',{
    state: () => ({
        orderId: 77542135451035,
        billList: [
            {
                orderId: '77542135451020',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451021',
                consigneeName: '李四',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451022',
                consigneeName: '王五',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451023',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451024',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451025',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451026',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451027',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451028',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451029',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451030',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451031',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451032',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451033',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
            {
                orderId: '77542135451034',
                consigneeName: '张三',
                telephone: '12345678910',
                address: '哈尔滨工业大学（威海）',
                orderStatus: '未提交',
                date: '2023-10-29 18:00',
                billDetail: [
                    {
                        goodsId: '98562135451020',
                        name: '可乐',
                        specification: '500ml',
                        amount: 20,
                        singlePrice: 5,
                        extra: '',
                        total: 100,
                    },
                ],
            },
        ],
    }),
    actions: {
        changeOrderId(){
            this.orderId++;
        },
        changeBill(id, obj){
            for(let i = 0; i < this.billList.length; i++){
                if(this.billList[i].orderId === id){
                    for(let key in obj){
                        this.billList[i][key] = obj[key];
                    }
                }
            }
        },
        createBill(obj){
            this.billList.unshift(obj);
        },
        changeState(id) {
            for(let i = 0; i < this.billList.length; i++){
                if(this.billList[i].orderId === id){
                    this.billList[i].orderStatus = '待审核';
                }
            }
        },
        deleteBill(id){
            let index;
            for(let i = 0; i < this.billList.length; i++){
                if(this.billList[i].orderId === id){
                    index = i;
                    break;
                }
            }
            this.billList.splice(index, 1);
        },
        checkBill(id, flag){
            if(flag){
                for(let i = 0; i < this.billList.length; i++){
                    if(this.billList[i].orderId === id){
                        this.billList[i].orderStatus = '已通过';
                        this.billList[i].checkDate = dayjs().format('YYYY-MM-DD');
                        this.billList[i].checkPerson = '客服小祥';
                        this.billList[i].payStatus = '未付款';
                        break;
                    }
                }
            } else {
                for(let i = 0; i < this.billList.length; i++){
                    if(this.billList[i].orderId === id){
                        this.billList[i].orderStatus = '已拒绝';
                        break;
                    }
                }
            }
        },
        completePay(id){
            const tableDataStore = useTableDataStore();
            let index;
            for(let i = 0; i < this.billList.length; i++){
                if(this.billList[i].orderId === id){
                    index = i;
                    break;
                }
            }
            this.billList[index].payStatus = '已付款';
            tableDataStore.changeRepertory(this.billList[index].billDetail, -1);
        },
        completeRefund(id){
            const tableDataStore = useTableDataStore();      
            let index;
            for(let i = 0; i < this.billList.length; i++){
                if(this.billList[i].orderId === id){
                    index = i;
                    break;
                }
            }
            tableDataStore.changeRepertory(this.billList[index].billDetail, 1);
            this.billList.splice(index, 1);
        }
    }
})